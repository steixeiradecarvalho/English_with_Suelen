<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greeting Rush</title>
    <style>
        body {
            margin: 0;
            background: url('assets/background-space.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Arial', sans-serif;
            touch-action: manipulation;
        }

        .voltar {
            width: 100%;
            padding: 10px;
            text-align: center;
        }

        #backButton {      
            cursor: pointer;
            background-color: #5bc0de;
            color: white;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            display: inline-block;

            padding: 10px 20px;
            font-size: 1em;
        }

        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            color: white;
            font-size: 1.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .game-area {
            position: relative;
            height: 60vh;
            border: 2px solid #4CAF50;
            border-radius: 15px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.5);
        }

        .alien {
            position: absolute;
            width: 80px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .speech-bubble {
            position: absolute;
            background: white;
            padding: 10px;
            border-radius: 8px;
            min-width: 120px;
            text-align: center;
            font-weight: bold;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
        }

        .answers-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
            justify-content: center;
        }

        .answer-box {
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s;
        }

        .answer-box:hover {
            transform: scale(1.05);
        }

        .powerup {
            position: absolute;
            width: 40px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .explosion {
            position: absolute;
            width: 64px;
            height: 64px;
            background-image: url('assets/explosion-sprite.png');
            animation: playExplosion 0.8s steps(8) forwards;
        }

        @keyframes playExplosion {
            100% { background-position: -512px; }
        }

        #game-over button, #game-over a { /* Estilizando ambos os bot√µes */
            display: block;          /* Para ocupar toda a largura */
            margin-top: 1rem;      /* Espa√ßamento entre os bot√µes */
            padding: 10px 20px;    /* Preenchimento interno */
            border: none;           /* Sem borda */
            border-radius: 5px;    /* Cantos arredondados */
            cursor: pointer;        /* Cursor de m√£o */
            text-decoration: none; /* Sem sublinhado no link */
            font-size: 16px;
        }


        #game-over button {
            background-color: #4CAF50; /* Verde */
            color: white;
        }

        #game-over a {  /* Estilizando o link como bot√£o */
            background-color: #008CBA; /* Azul */
            color: white;
            text-align: center;  /* Centralizar o texto */
        }


        #game-over a:hover {
           background-color: #005f7d; /* Azul mais escuro no hover*/
        }
         #game-over button:hover {
           background-color: #367c39; /* Verde mais escuro no hover*/
        }

        .game-title { /* Estilos para o t√≠tulo */
            text-align: center;
            color: white;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* Sombra para destacar */
            margin-bottom: 10px; /* Espa√ßamento inferior */
        }

        .game-instructions { /* Estilos para as instru√ß√µes */
            text-align: center;
            color: white;
            font-size: 1.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* Adicione ao CSS */
        .glow {
            animation: glowDisappear 0.5s ease-out forwards;
        }

        @keyframes glowDisappear {
            from { filter: brightness(1); opacity: 1; }
            to { filter: brightness(3); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">Spatial Greeting Rush</h1>  <!-- T√≠tulo -->
        <p class="game-instructions">Cumprimente os alien√≠genas. Complete 10 acertos em 180 segundos</p> <!-- Instru√ß√µes -->

        <div class="game-header">
            <span id="score">‚≠ê 0</span>
            <span id="timer">‚è±Ô∏è 90s</span>
            <span id="interactions">üìù 0/20</span>
        </div>

        <div id="game-area" class="game-area"></div>
        
        <div id="answers" class="answers-container"></div>

        <div id="game-over">
            <h2>Resultado Final</h2>
            <p>Acertos: <span id="correct-answers">0</span></p>
            <p>Pontua√ß√£o: <span id="final-score">0</span></p>
            <button id="retry">üîÅ Repetir</button>
            <a href="./../../index.html" role="button">Home</a> <!-- Link estilizado como bot√£o -->
        </div>

        <div class="voltar">
            <br><br><br>
            <a id="backButton" href="./../../index.html">Home</a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // Dados incorporados diretamente para evitar problemas de carregamento
        const greetingsData = [
            { prompt: "Hello!", correctAnswer: "Hi there!", options: ["Goodbye!", "Hi there!", "What's up?", "Good night!"] },
            { prompt: "Hi!", correctAnswer: "Hello!", options: ["Bye!", "Hello!", "Good evening!", "See you tomorrow!"] },
            { prompt: "Good morning!", correctAnswer: "Morning! How are you?", options: ["Good night!", "See you later!", "Morning! How are you?", "What's your name?"] },
            { prompt: "Good afternoon!", correctAnswer: "Good afternoon! How‚Äôs it going?", options: ["Good night!", "See you soon!", "Good afternoon! How‚Äôs it going?", "Bye bye!"] },
            { prompt: "Good evening!", correctAnswer: "Good evening to you!", options: ["Good morning!", "Bye!", "Good evening to you!", "How are you going?"] },
            { prompt: "Good night!", correctAnswer: "Sweet dreams!", options: ["Hello!", "See you!", "Sweet dreams!", "Good afternoon!"] },
            { prompt: "Bye!", correctAnswer: "Goodbye!", options: ["Hi there!", "Goodbye!", "How are you?", "Good evening!"] },
            { prompt: "Bye bye!", correctAnswer: "See you later!", options: ["Good morning!", "See you later!", "Hi!", "I‚Äôm fine, thanks!"] },
            { prompt: "See you!", correctAnswer: "See you soon!", options: ["Good night!", "What‚Äôs up?", "See you soon!", "Hello!"] },
            { prompt: "See you tomorrow!", correctAnswer: "Until tomorrow!", options: ["Good evening!", "Until tomorrow!", "Bye bye!", "How are you?"] },
            { prompt: "See you soon!", correctAnswer: "Looking forward to it!", options: ["Goodbye!", "Good afternoon!", "Looking forward to it!", "Nice to meet you!"] },
            { prompt: "How are you?", correctAnswer: "I‚Äôm fine, thanks!", options: ["I‚Äôm fine, thanks!", "My name is John.", "Nice to meet you.", "Goodbye!"] },
            { prompt: "How are you going?", correctAnswer: "I‚Äôm good, you?", options: ["See you tomorrow!", "I‚Äôm good, you?", "Good night!", "Hi there!"] },
            { prompt: "Nice to meet you!", correctAnswer: "Nice to meet you too!", options: ["Goodbye!", "What‚Äôs your name?", "Nice to meet you too!", "I don‚Äôt know."] },
            { prompt: "See you later!", correctAnswer: "See you!", options: ["Hello!", "Good morning!", "What‚Äôs up?", "See you!"] }
        ];

        class GreetingRush {
            constructor() {
                this.gameArea = document.getElementById('game-area');
                this.answersContainer = document.getElementById('answers');
                this.scoreElement = document.getElementById('score');
                this.timerElement = document.getElementById('timer');
                this.interactionsElement = document.getElementById('interactions');
                this.correctAnswersElement = document.getElementById('correct-answers');
                this.finalScoreElement = document.getElementById('final-score');
                this.retryButton = document.getElementById('retry');
                
                // J√° definimos os dados diretamente
                this.greetingsData = greetingsData;
                
                this.gameState = {
                    score: 0,
                    timeLeft: 180,
                    interactions: 0,    // Manteremos essa vari√°vel, mas para outro prop√≥sito
                    correctCount: 0,    // Esta ser√° a vari√°vel importante para contagem
                    activeAliens: [],
                    timerInterval: null
                };

                this.retryButton.addEventListener('click', () => this.restartGame());
                
                this.init();
            }

            async init() {
                try {
                    await this.preloadAssets();
                    this.startGame();
                } catch (error) {
                    console.error("Erro ao inicializar o jogo:", error);
                    alert("Ocorreu um erro ao iniciar o jogo. Verifique o console para mais detalhes.");
                }
            }

            async preloadAssets() {
                this.assets = {
                    aliens: []
                };
                
                // Criar aliens simples com emojis para evitar problemas de carregamento de imagens
                this.alienEmojis = ["üëΩ", "üëæ", "üõ∏", "ü§ñ", "üõ∏"];
            }

            startGame() {
                console.log("Iniciando jogo com dados:", this.greetingsData);
                
                // Limpar elementos do jogo
                this.gameArea.innerHTML = '';
                this.answersContainer.innerHTML = '';
                
                // Resetar estado do jogo
                this.gameState.score = 0;
                this.gameState.timeLeft = 180;
                this.gameState.interactions = 0;
                this.gameState.correctCount = 0;
                this.gameState.activeAliens = [];
                
                // Atualizar UI
                this.updateUI();
                
                // Esconder tela de game over
                document.getElementById('game-over').style.display = 'none';
                
                // Iniciar timer
                this.startTimer();
                
                // Iniciar gera√ß√£o de aliens
                this.spawnAlienInterval = setInterval(() => this.spawnAlien(), 4000); // CONFIG ***************
                
                // Spawn do primeiro alien imediatamente
                setTimeout(() => this.spawnAlien(), 500);
            }

            restartGame() {
                // Limpar intervalos anteriores
                clearInterval(this.gameState.timerInterval);
                clearInterval(this.spawnAlienInterval);
                
                // Iniciar novo jogo
                this.startGame();
            }

            startTimer() {
                // Limpar intervalo anterior se existir
                if (this.gameState.timerInterval) {
                    clearInterval(this.gameState.timerInterval);
                }
                
                this.gameState.timerInterval = setInterval(() => {
                    if (this.gameState.timeLeft > 0) {
                        this.gameState.timeLeft--;
                        this.updateUI();
                    } else {
                        clearInterval(this.gameState.timerInterval);
                        clearInterval(this.spawnAlienInterval);
                        this.endGame();
                    }
                }, 1000);
            }

            spawnAlien() {
                if (this.gameState.activeAliens.length >= 2) return; // CONFIG ******************
                // Verificar se temos dados de sauda√ß√µes
                if (!this.greetingsData || this.greetingsData.length === 0) {
                    console.error("Dados de sauda√ß√µes n√£o dispon√≠veis");
                    return;
                }

                // Selecionar quest√£o aleat√≥ria
                const questionIndex = Math.floor(Math.random() * this.greetingsData.length);
                const question = this.greetingsData[questionIndex];
                
                if (!question || !question.prompt) {
                    console.error("Quest√£o inv√°lida:", question);
                    return;
                }

                // Criar container do alien
                const alienContainer = document.createElement('div');
                alienContainer.className = 'alien';
                alienContainer.style.left = Math.floor(Math.random() * 80) + '%';
                alienContainer.style.top = Math.floor(Math.random() * 60) + '%';
                
                const animation = alienContainer.animate(
                    [{ top: alienContainer.style.top }, { top: '100%' }],
                    { duration: 30000, easing: 'linear' }                  // CONFIG ****************
                );

                const alienData = {
                    element: alienContainer,
                    question: question,
                    animation: animation
                };
                this.gameState.activeAliens.push(alienData);

                // Tratamento do fim da anima√ß√£o
                animation.onfinish = () => {
                    if (this.gameArea.contains(alienContainer)) {
                        this.handleAlienReachBottom(alienData);
                    }
                };

                
                
                // Selecionar emoji aleat√≥rio para o alien
                const alienEmoji = this.alienEmojis[Math.floor(Math.random() * this.alienEmojis.length)];
                
                // Criar visual do alien (usando emoji para simplificar)
                const alienVisual = document.createElement('div');
                alienVisual.style.fontSize = '50px';
                alienVisual.textContent = alienEmoji;
                
                // Criar bolha de fala
                const speechBubble = document.createElement('div');
                speechBubble.className = 'speech-bubble';
                speechBubble.textContent = question.prompt;
                
                // Adicionar elementos ao container
                alienContainer.appendChild(speechBubble);
                alienContainer.appendChild(alienVisual);
                
                // Adicionar container √† √°rea de jogo
                this.gameArea.appendChild(alienContainer);
                
                // Adicionar refer√™ncia ao array de aliens ativos
                const XalienData = {
                    element: alienContainer,
                    question: question
                };
                this.gameState.activeAliens.push(alienData);
                
                // Mostrar op√ß√µes de resposta
                this.showAnswerOptions(question);
                
                // Remover alien ap√≥s 25 segundos se n√£o for clicado
                setTimeout(() => {
                    if (this.gameArea.contains(alienContainer)) {
                        alienContainer.remove();
                        this.gameState.activeAliens = this.gameState.activeAliens.filter(a => a.element !== alienContainer);
                    }
                }, 45000);  // CONFIG ***********************************************
            }

            handleAlienReachBottom(alienData) {
                this.createExplosion(alienData.element);
                alienData.element.remove();
                this.gameState.activeAliens = this.gameState.activeAliens.filter(a => a !== alienData);
            }

            createExplosion(element) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                
                // Posiciona a explos√£o
                const rect = element.getBoundingClientRect();
                explosion.style.left = `${rect.left - this.gameArea.getBoundingClientRect().left}px`;
                explosion.style.top = `${rect.top - this.gameArea.getBoundingClientRect().top}px`;
                
                this.gameArea.appendChild(explosion);
                setTimeout(() => explosion.remove(), 800);
            }

            showAnswerOptions(question) {
                // Limpar op√ß√µes anteriores
                this.answersContainer.innerHTML = '';
                
                // Verificar se temos op√ß√µes v√°lidas
                if (!question.options || !Array.isArray(question.options) || question.options.length === 0) {
                    console.error("Op√ß√µes inv√°lidas para a quest√£o:", question);
                    // Criar op√ß√µes padr√£o se n√£o tivermos op√ß√µes v√°lidas
                    question.options = ["Sim", "N√£o", "Talvez", question.correctAnswer || "Ol√°"];
                }
                
                // Embaralhar op√ß√µes
                const options = [...question.options];
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                // Criar bot√µes de resposta
                options.forEach(option => {
                    const answerBox = document.createElement('div');
                    answerBox.className = 'answer-box';
                    answerBox.textContent = option;
                    answerBox.addEventListener('click', () => {
                        this.checkAnswer(option, question.correctAnswer);
                    });
                    this.answersContainer.appendChild(answerBox);
                });
            }

            checkAnswer(selectedAnswer, correctAnswer) {
                const currentAlien = this.gameState.activeAliens[this.gameState.activeAliens.length - 1];

                if (selectedAnswer === correctAnswer) {
                    currentAlien.animation.cancel();
                    currentAlien.element.classList.add('glow');
                    currentAlien.element.addEventListener('animationend', () => {
                        currentAlien.element.remove();
                        this.gameState.activeAliens.pop();
                    });
                    // Resposta correta
                    this.gameState.score += 10;
                    this.gameState.correctCount++;
                    
                    // Efeito visual de acerto
                    this.showFeedback(true);
                    
                    // Verificar se atingiu 20 acertos
                    if (this.gameState.correctCount >= 10) { // CONFIG *******************
                        // Adicionando method call expl√≠cito
                        this.triggerConfetti();
                        // Finalizando o jogo ap√≥s atingir 20 acertos
                        clearInterval(this.spawnAlienInterval);
                        this.endGame();
                    }
                } else {
                    // Resposta incorreta
                    this.showFeedback(false);
                }
                
                // Limpar aliens ativos e preparar para o pr√≥ximo
                if (this.gameState.activeAliens.length > 0) {
                    const firstAlien = this.gameState.activeAliens[0].element;
                    firstAlien.remove();
                    this.gameState.activeAliens.shift();
                }
                
                // Atualizar UI
                this.updateUI();
            }

            showFeedback(isCorrect) {
                // Criar elemento de feedback
                const feedback = document.createElement('div');
                feedback.style.position = 'fixed';
                feedback.style.top = '50%';
                feedback.style.left = '50%';
                feedback.style.transform = 'translate(-50%, -50%)';
                feedback.style.fontSize = '2em';
                feedback.style.fontWeight = 'bold';
                feedback.style.color = isCorrect ? '#4CAF50' : '#FF5722';
                feedback.style.zIndex = '1000';
                feedback.textContent = isCorrect ? '‚úì Correto!' : '‚úó Incorreto!';
                
                // Adicionar ao corpo do documento
                document.body.appendChild(feedback);
                
                // Remover ap√≥s anima√ß√£o
                setTimeout(() => {
                    feedback.remove();
                }, 1000);
            }

            updateUI() {
                // Atualizar elementos de UI
                this.scoreElement.textContent = `‚≠ê ${this.gameState.score}`;
                this.timerElement.textContent = `‚è±Ô∏è ${this.gameState.timeLeft}s`;
                // Agora mostramos os acertos, n√£o as intera√ß√µes
                this.interactionsElement.textContent = `üìù ${this.gameState.correctCount}/10`;
            }
            triggerConfetti() {
                const count = 200;
                const defaults = {
                    origin: { y: 0.7 }
                };

                const fire = (particleRatio, opts) => {
                    confetti(Object.assign({}, defaults, opts, {
                        particleCount: Math.floor(count * particleRatio)
                    }));
                };

                fire(0.25, { spread: 26, startVelocity: 55 });
                fire(0.2, { spread: 60 });
                fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
                fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
                fire(0.1, { spread: 120, startVelocity: 45 });
            }
            
            endGame() {
                // Atualizar resultados finais
                this.correctAnswersElement.textContent = this.gameState.correctCount;
                this.finalScoreElement.textContent = this.gameState.score;
                
                // Mostrar tela de game over
                document.getElementById('game-over').style.display = 'block';
                
                // Limpar √°rea de jogo
                this.gameArea.innerHTML = '';
                this.answersContainer.innerHTML = '';
            }
        }

        // Inicializar o jogo quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => new GreetingRush());
    </script>
</body>
</html>
