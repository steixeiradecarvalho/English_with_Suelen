<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo's English Safari</title>
    <style>
        :root {
            --platform-color: #8B4513;
            --bg-color: #FFF8DC;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            background-color: var(--bg-color);
            overflow: hidden;
            touch-action: manipulation;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background-image: linear-gradient(#87CEEB, #FFF8DC);
        }
        
        #game-area {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        #mission-text {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            z-index: 100;
            font-size: 1rem;
        }
        
        #player {
            position: absolute;
            font-size: 2rem;
            z-index: 10;
            transition: transform 0.1s ease;
        }
        
        .platform {
            position: absolute;
            background-color: var(--platform-color);
            border-radius: 8px;
        }
        
        .collectible {
            position: absolute;
            font-size: 1.5rem;
            z-index: 5;
        }
        
        #controls {
            position: fixed;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 100;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            user-select: none;
            touch-action: manipulation;
        }
        
        #score-container {
            position: absolute;
            top: 70px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            z-index: 100;
        }
        
        #level-complete {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 200;
            display: none;
        }
        
        @media (min-width: 768px) {
            #controls {
                display: none;
            }
            
            #mission-text {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="mission-text">
            <div class="english">Find five red pants</div>
            <div class="portuguese">O Le√£o, precisa achar 5 cal√ßas vermelhas</div>
        </div>
        
        <div id="score-container">
            Found: <span id="score">0</span>/<span id="total-items">5</span>
        </div>
        
        <div id="game-area">
            <div id="player">ü¶Å</div>
            <!-- Platforms and collectibles will be generated by JS -->
        </div>
        
        <div id="controls">
            <div class="control-btn" id="left-btn">‚¨ÖÔ∏è</div>
            <div class="control-btn" id="jump-btn">‚¨ÜÔ∏è</div>
            <div class="control-btn" id="right-btn">‚û°Ô∏è</div>
        </div>
        
        <div id="level-complete">
            <h2>Level Complete!</h2>
            <p>Well done! You found all items.</p>
            <button id="next-level-btn">Next Level</button>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            player: {
                x: 50,
                y: 0,
                width: 40,
                height: 40,
                velX: 0,
                velY: 0,
                speed: 5,
                jumping: false,
                grounded: false
            },
            keys: {},
            gravity: 0.5,
            friction: 0.8,
            platforms: [],
            collectibles: [],
            collected: 0,
            currentLevel: 1,
            isLevelComplete: false
        };

        // Level configurations
        const levels = [
            {
                mission: {
                    english: "Find five red pants",
                    portuguese: "O Le√£o, precisa achar 5 cal√ßas vermelhas"
                },
                totalItems: 5,
                collectibleEmoji: "üëñ",
                collectibleClass: "red-pants",
                platforms: [
                    {x: 0, y: 500, width: 800, height: 20},
                    {x: 200, y: 400, width: 150, height: 20},
                    {x: 450, y: 350, width: 150, height: 20},
                    {x: 100, y: 250, width: 150, height: 20}
                ],
                collectibles: [
                    {x: 50, y: 460},
                    {x: 250, y: 360},
                    {x: 500, y: 310},
                    {x: 150, y: 210},
                    {x: 700, y: 460}
                ]
            },
            {
                mission: {
                    english: "Find twenty-two apples in the basket",
                    portuguese: "O Le√£o, precisa achar 22 ma√ß√£s na cesta"
                },
                totalItems: 22,
                collectibleEmoji: "üçé",
                collectibleClass: "apple",
                platforms: [
                    {x: 0, y: 500, width: 800, height: 20},
                    {x: 150, y: 420, width: 120, height: 20},
                    {x: 350, y: 350, width: 120, height: 20},
                    {x: 100, y: 280, width: 120, height: 20},
                    {x: 500, y: 250, width: 120, height: 20}
                ],
                basket: {x: 600, y: 460, emoji: "üß∫"}
            },
            {
                mission: {
                    english: "Find a girl with a pink dress and a boy with a brown cap",
                    portuguese: "O Le√£o, precisa achar uma menina com um vestido rosa e um menino com um chap√©u marrom"
                },
                totalItems: 2,
                characters: [
                    {x: 150, y: 460, emoji: "üë©", type: "distractor"},
                    {x: 250, y: 460, emoji: "üë®", type: "distractor"},
                    {x: 350, y: 460, emoji: "üëß", type: "girl_pink_dress"},
                    {x: 450, y: 460, emoji: "üë¶", type: "boy_brown_cap"},
                    {x: 550, y: 460, emoji: "üßì", type: "distractor"},
                    {x: 650, y: 460, emoji: "üë∂", type: "distractor"}
                ],
                platforms: [
                    {x: 0, y: 500, width: 800, height: 20}
                ]
            },
            {
                mission: {
                    english: "Find people with sunglasses",
                    portuguese: "O Le√£o, precisa achar pessoas com √≥culos de sol"
                },
                totalItems: 3,
                characters: [
                    {x: 100, y: 460, emoji: "üë®", type: "distractor"},
                    {x: 200, y: 460, emoji: "üòé", type: "sunglasses"},
                    {x: 300, y: 460, emoji: "üë©", type: "distractor"},
                    {x: 400, y: 360, emoji: "üòé", type: "sunglasses"},
                    {x: 500, y: 460, emoji: "üëß", type: "distractor"},
                    {x: 600, y: 270, emoji: "üòé", type: "sunglasses"},
                    {x: 700, y: 460, emoji: "üë¥", type: "distractor"}
                ],
                platforms: [
                    {x: 0, y: 500, width: 800, height: 20},
                    {x: 350, y: 400, width: 150, height: 20},
                    {x: 550, y: 310, width: 150, height: 20}
                ]
            }
        ];

        // DOM elements
        const player = document.getElementById('player');
        const gameArea = document.getElementById('game-area');
        const missionText = document.getElementById('mission-text');
        const scoreElement = document.getElementById('score');
        const totalItemsElement = document.getElementById('total-items');
        const levelCompleteModal = document.getElementById('level-complete');
        const nextLevelBtn = document.getElementById('next-level-btn');

        // Mobile controls
        const leftBtn = document.getElementById('left-btn');
        const jumpBtn = document.getElementById('jump-btn');
        const rightBtn = document.getElementById('right-btn');

        // Initialize game
        function initGame() {
            // Set up the current level
            loadLevel(gameState.currentLevel);
            
            // Event listeners
            document.addEventListener('keydown', keyDownHandler);
            document.addEventListener('keyup', keyUpHandler);
            
            // Mobile control events
            leftBtn.addEventListener('touchstart', () => gameState.keys[37] = true);
            leftBtn.addEventListener('touchend', () => gameState.keys[37] = false);
            rightBtn.addEventListener('touchstart', () => gameState.keys[39] = true);
            rightBtn.addEventListener('touchend', () => gameState.keys[39] = false);
            jumpBtn.addEventListener('touchstart', () => {
                if (!gameState.player.jumping && gameState.player.grounded) {
                    gameState.player.jumping = true;
                    gameState.player.grounded = false;
                    gameState.player.velY = -12;
                }
            });
            
            nextLevelBtn.addEventListener('click', () => {
                gameState.currentLevel++;
                if (gameState.currentLevel <= levels.length) {
                    loadLevel(gameState.currentLevel);
                    levelCompleteModal.style.display = 'none';
                    gameState.isLevelComplete = false;
                } else {
                    // Game complete
                    missionText.innerHTML = `<div>Congratulations! You've completed all levels!</div>`;
                    levelCompleteModal.innerHTML = `
                        <h2>Game Complete!</h2>
                        <p>Well done! You've completed all levels!</p>
                        <button id="restart-btn">Play Again</button>
                    `;
                    document.getElementById('restart-btn').addEventListener('click', () => {
                        gameState.currentLevel = 1;
                        loadLevel(1);
                        levelCompleteModal.style.display = 'none';
                    });
                }
            });
            
            // Start game loop
            requestAnimationFrame(update);
        }

        // Load level
        function loadLevel(levelIndex) {
            const level = levels[levelIndex - 1];
            
            // Reset game state
            gameState.player.x = 50;
            gameState.player.y = 0;
            gameState.collected = 0;
            gameState.platforms = [];
            gameState.collectibles = [];
            
            // Update UI
            missionText.innerHTML = `
                <div class="english">${level.mission.english}</div>
                <div class="portuguese">${level.mission.portuguese}</div>
            `;
            
            scoreElement.textContent = '0';
            totalItemsElement.textContent = level.totalItems || '0';
            
            // Clear game area (except player)
            const elementsToRemove = document.querySelectorAll('.platform, .collectible');
            elementsToRemove.forEach(el => el.remove());
            
            // Create platforms
            level.platforms.forEach(platform => {
                createPlatform(platform.x, platform.y, platform.width, platform.height);
            });
            
            // Create collectibles
            if (level.collectibles) {
                level.collectibles.forEach(item => {
                    createCollectible(item.x, item.y, level.collectibleEmoji, level.collectibleClass);
                });
            }
            
            // Create basket (Level 2)
            if (level.basket) {
                const basket = document.createElement('div');
                basket.className = 'collectible basket';
                basket.textContent = level.basket.emoji;
                basket.style.left = `${level.basket.x}px`;
                basket.style.top = `${level.basket.y}px`;
                basket.style.fontSize = '3rem';
                gameArea.appendChild(basket);
            }
            
            // Create characters (Level 3 & 4)
            if (level.characters) {
                level.characters.forEach(char => {
                    const character = document.createElement('div');
                    character.className = `collectible character ${char.type}`;
                    character.dataset.type = char.type;
                    character.textContent = char.emoji;
                    character.style.left = `${char.x}px`;
                    character.style.top = `${char.y}px`;
                    gameArea.appendChild(character);
                    
                    if (char.type === 'girl_pink_dress' || char.type === 'boy_brown_cap' || char.type === 'sunglasses') {
                        gameState.collectibles.push({
                            x: char.x,
                            y: char.y,
                            width: 30,
                            height: 30,
                            collected: false,
                            element: character
                        });
                    }
                });
            }
            
            // Responsive adjustments
            adjustForScreenSize();
            window.addEventListener('resize', adjustForScreenSize);
        }

        // Create platform element
        function createPlatform(x, y, width, height) {
            const platform = document.createElement('div');
            platform.className = 'platform';
            platform.style.left = `${x}px`;
            platform.style.top = `${y}px`;
            platform.style.width = `${width}px`;
            platform.style.height = `${height}px`;
            gameArea.appendChild(platform);
            
            gameState.platforms.push({
                x: x,
                y: y,
                width: width,
                height: height
            });
        }

        // Create collectible item
        function createCollectible(x, y, emoji, className) {
            const collectible = document.createElement('div');
            collectible.className = `collectible ${className}`;
            collectible.textContent = emoji;
            collectible.style.left = `${x}px`;
            collectible.style.top = `${y}px`;
            
            // Special style for red pants
            if (className === 'red-pants') {
                collectible.style.filter = 'hue-rotate(320deg) saturate(3)';
            }
            
            gameArea.appendChild(collectible);
            
            gameState.collectibles.push({
                x: x,
                y: y,
                width: 30,
                height: 30,
                collected: false,
                element: collectible
            });
        }

        // Key handlers
        function keyDownHandler(e) {
            gameState.keys[e.keyCode] = true;
        }

        function keyUpHandler(e) {
            gameState.keys[e.keyCode] = false;
        }

        // Game loop
        function update() {
            if (!gameState.isLevelComplete) {
                // Player movement
                if (gameState.keys[37]) {
                    // Left arrow
                    if (gameState.player.velX > -gameState.player.speed) {
                        gameState.player.velX--;
                    }
                }
                
                if (gameState.keys[39]) {
                    // Right arrow
                    if (gameState.player.velX < gameState.player.speed) {
                        gameState.player.velX++;
                    }
                }
                
                if (gameState.keys[38] || gameState.keys[32]) {
                    // Up arrow or Space
                    if (!gameState.player.jumping && gameState.player.grounded) {
                        gameState.player.jumping = true;
                        gameState.player.grounded = false;
                        gameState.player.velY = -12;
                    }
                }
                
                // Apply physics
                gameState.player.velX *= gameState.friction;
                gameState.player.velY += gameState.gravity;
                
                gameState.player.grounded = false;
                
                // Collision detection with platforms
                for (let i = 0; i < gameState.platforms.length; i++) {
                    const p = gameState.platforms[i];
                    
                    if (gameState.player.x + gameState.player.width > p.x &&
                        gameState.player.x < p.x + p.width &&
                        gameState.player.y + gameState.player.height > p.y &&
                        gameState.player.y + gameState.player.height < p.y + p.height) {
                        gameState.player.grounded = true;
                        gameState.player.jumping = false;
                        gameState.player.y = p.y - gameState.player.height;
                        gameState.player.velY = 0;
                    }
                }
                
                // Update player position
                gameState.player.x += gameState.player.velX;
                gameState.player.y += gameState.player.velY;
                
                // Screen boundaries
                if (gameState.player.x < 0) {
                    gameState.player.x = 0;
                } else if (gameState.player.x + gameState.player.width > gameArea.offsetWidth) {
                    gameState.player.x = gameArea.offsetWidth - gameState.player.width;
                }
                
                if (gameState.player.y < 0) {
                    gameState.player.y = 0;
                    gameState.player.velY = 0;
                } else if (gameState.player.y + gameState.player.height > gameArea.offsetHeight) {
                    gameState.player.y = gameArea.offsetHeight - gameState.player.height;
                    gameState.player.grounded = true;
                    gameState.player.jumping = false;
                }
                
                // Update player element position
                player.style.left = `${gameState.player.x}px`;
                player.style.top = `${gameState.player.y}px`;
                
                // Check collectible collision
                checkCollectibles();
                
                // Check if level complete
                const currentLevel = levels[gameState.currentLevel - 1];
                if (gameState.collected === currentLevel.totalItems) {
                    gameState.isLevelComplete = true;
                    levelCompleteModal.style.display = 'block';
                }
            }
            
            requestAnimationFrame(update);
        }

        // Check collision with collectibles
        function checkCollectibles() {
            for (let i = 0; i < gameState.collectibles.length; i++) {
                const item = gameState.collectibles[i];
                
                if (!item.collected &&
                    gameState.player.x + gameState.player.width > item.x &&
                    gameState.player.x < item.x + item.width &&
                    gameState.player.y + gameState.player.height > item.y &&
                    gameState.player.y < item.y + item.height) {
                    
                    // Special case for level 3 and 4
                    if (gameState.currentLevel === 3) {
                        const itemType = item.element.dataset.type;
                        if (itemType === 'girl_pink_dress' || itemType === 'boy_brown_cap') {
                            collectItem(item);
                        }
                    } else if (gameState.currentLevel === 4) {
                        const itemType = item.element.dataset.type;
                        if (itemType === 'sunglasses') {
                            collectItem(item);
                        }
                    } else {
                        collectItem(item);
                    }
                }
            }
        }

        // Collect item
        function collectItem(item) {
            item.collected = true;
            item.element.style.opacity = '0.3';
            gameState.collected++;
            scoreElement.textContent = gameState.collected;
            
            // Play collect sound (placeholder)
            const collectSound = new Audio('data:audio/wav;base64,UklGRl9vT19WAVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU......');
            collectSound.volume = 0.3;
            collectSound.play().catch(e => console.log('Audio play failed:', e));
        }

        // Adjust for screen size
        function adjustForScreenSize() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            // Scale game elements
            const scaleFactor = Math.min(width / 800, height / 600);
            
            // Adjust player size
            player.style.fontSize = `${Math.max(2, 2 * scaleFactor)}rem`;
            gameState.player.width = Math.max(40, 40 * scaleFactor);
            gameState.player.height = Math.max(40, 40 * scaleFactor);
            
            // Adjust collectibles
            document.querySelectorAll('.collectible').forEach(el => {
                el.style.fontSize = `${Math.max(1.5, 1.5 * scaleFactor)}rem`;
            });
            
            // Adjust basket (if exists)
            const basket = document.querySelector('.basket');
            if (basket) {
                basket.style.fontSize = `${Math.max(3, 3 * scaleFactor)}rem`;
            }
        }

        // Initialize the game when the page loads
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
