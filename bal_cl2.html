    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>World Teaching School-Curso de Inglês</title>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans&family=Quicksand:wght@500&display=swap" rel="stylesheet">
        
        <style>
            :root {
                --orange: #FF7F00;
                --yellow: #FFD700;
                --blue: #4682B4;
                --green: #32CD32;
                --white: #FFFFFF;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Open Sans', sans-serif;
                background: linear-gradient(135deg, var(--white) 0%, #f8f8f8 100%);
            }

            /* Estrutura Principal */
            .container {
                display: grid;
                grid-template-columns: 280px 1fr;
                min-height: 100vh;
            }

            /* Sidebar Menu */
            .sidebar {
                background: var(--blue);
                padding: 2rem;
                box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            }

            .logo-container {
                margin-bottom: 2rem;
                padding: 0 0.5rem; /* Ajuste opcional para espaçamento lateral */
            }

            .logo {
                width: 100% !important;
                height: 80px !important; /* Altura ajustável conforme necessidade */
                background-size: contain;
                background-position: center;
                background-repeat: no-repeat; /* Para evitar repetição da imagem */
                background-image: url("logoWTS.png"); 
                margin: 0 auto;
                display: block;
            }

            /* Menu de Módulos */
            .module-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 1.5rem;
                padding: 2rem;
            }

            .module-card {
                background: var(--white);
                border-radius: 15px;
                padding: 1.5rem;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                transition: transform 0.3s ease;
                cursor: pointer;
                position: relative;
                overflow: hidden;
            }

            .module-card:hover {
                transform: translateY(-5px);
            }

            .module-progress {
                height: 8px;
                background: #eee;
                border-radius: 4px;
                margin: 1rem 0;
            }

            .module-progress-bar {
                height: 100%;
                background: var(--green);
                border-radius: 4px;
                transition: width 0.5s ease;
            }

            /* Elementos Gamificados */
            .badge {
                position: absolute;
                top: -10px;
                right: -10px;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                font-family: 'Quicksand', sans-serif;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                transition: transform 0.3s ease;
                background: var(--yellow);
                color: var(--blue);
                padding: 5px;
                text-align: center;
                font-size: 0.8rem;
            }
            
            /* Tipos de Badges */
            .badge[data-badge-type="completed"] {
                background: var(--green);
                color: white;
            }

            .badge[data-badge-type="daily-challenge"] {
                background: var(--orange);
                color: white;
                animation: pulse 1.5s infinite;
            }

            .badge[data-difficulty="gold"] {
                background: linear-gradient(45deg, #FFD700, #D4AF37);
            }

            /* Estados Interativos */
            .badge:hover {
                transform: scale(1.1) rotate(15deg);
                cursor: pointer;
            }

            .badge::after {
                content: attr(data-tooltip);
                position: absolute;
                bottom: 100%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 0.75rem;
                white-space: nowrap;
                opacity: 0;
                transition: opacity 0.3s;
            }

            .badge:hover::after {
                opacity: 1;
            }

            /* Animação */
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
            /* Tela de Exercício */
            .exercise-screen {
                display: none;
                padding: 2rem;
            }

            /* Responsividade */
            @media (max-width: 768px) {
                .container {
                    grid-template-columns: 1fr;
                }
                
                .sidebar {
                    position: fixed;
                    width: 100%;
                    height: auto;
                    z-index: 100;
                    overflow-y: auto; /* Adiciona rolagem, se necessário */
                }
            }
            
            /* Adicione estes estilos */
            .back-button {
                background: none;
                border: none;
                color: var(--blue);
                font-size: 1.1rem;
                cursor: pointer;
                margin-bottom: 1rem;
                padding: 0.5rem;
                transition: all 0.3s ease;
            }

            .back-button:hover {
                transform: translateX(-5px);
                color: var(--orange);
            }

            /* Estilos para o resultado */
            .result-container {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5); /* Fundo escuro semi-transparente */
                justify-content: center;
                align-items: center;
                z-index: 101; /* Acima de tudo */
            }

            .result-content {
                background: var(--white);
                border-radius: 15px;
                padding: 2rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
                text-align: center;
                animation: slide-in 0.5s ease-in-out;
            }

            .result-correct {
                color: var(--green);
            }

            .result-incorrect {
                color: #ff4444;
            }
            @keyframes slide-in {
                from {
                    transform: translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            /* Tela de Resultados */
            .results-screen {
                display: none;
                padding: 2rem;
                text-align: center;
            }

            .results-container {
                background: var(--white);
                border-radius: 15px;
                padding: 2rem;
                margin: 2rem auto;
                max-width: 800px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }

            .progress-update {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin: 2rem 0;
            }

            .progress-circle {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                background: var(--blue);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: 'Montserrat', sans-serif;
                font-size: 1.5rem;
            }

            .celebration {
                font-size: 4rem;
                margin: 1rem 0;
                animation: celebrate 1s ease infinite;
            }

            @keyframes celebrate {
                0% { transform: scale(1); }
                50% { transform: scale(1.2) rotate(10deg); }
                100% { transform: scale(1); }
            }

            .module-progress-bar {
                transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
            }

            /* Efeito de brilho */
            .module-progress-bar::after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent
                );
                animation: shine 1.5s infinite;
            }

            @keyframes shine {
                to {
                    left: 100%;
                }
            }
            
            .score-indicator {
                transform: scale(0);
                opacity: 0;
                transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .score-indicator.show {
                transform: scale(1);
                opacity: 1;
            }

            .button {
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .button:active {
                transform: translateY(1px);
            }

            /* Efeito de ripple */
            .button::after {
                content: '';
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                transform: scale(0);
                animation: ripple 0.6s linear;
            }

            .module-card {
                transition: all 0.3s ease;
            }

            .module-card.locked {
                filter: grayscale(1);
                opacity: 0.7;
                cursor: not-allowed;
            }

            .module-card.active {
                border: 2px solid var(--blue);
                box-shadow: 0 0 15px rgba(70, 130, 180, 0.3);
            }

            .module-card.completed {
                border-color: var(--green);
            }

            .toast {
                position: fixed;
                bottom: 20px;
                right: 20px;
                padding: 12px 24px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                transform: translateY(100%);
                opacity: 0;
                transition: all 0.3s ease;
            }

            .toast.show {
                transform: translateY(0);
                opacity: 1;
            }

            .toast-progress {
                position: absolute;
                bottom: 0;
                left: 0;
                height: 3px;
                background: var(--blue);
                animation: toast-progress 3s linear;
            }

            @keyframes celebrate {
                0% { transform: scale(1); }
                50% { transform: scale(1.2) rotate(10deg); }
                100% { transform: scale(1); }
            }

            .achievement-badge {
                animation: celebrate 1s ease;
            }

            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                animation: confetti-fall 3s linear infinite;
            }

            @keyframes confetti-fall {
                0% { 
                    transform: translateY(-100%) rotate(0deg);
                    opacity: 1;
                }
                100% { 
                    transform: translateY(100vh) rotate(360deg);
                    opacity: 0;
                }
            }

            :focus {
                outline: 3px solid var(--blue);
                outline-offset: 2px;
            }

            .focus-visible {
                position: relative;
            }

            .focus-visible::after {
                content: '';
                position: absolute;
                inset: -4px;
                border: 2px solid var(--blue);
                border-radius: 4px;
                opacity: 0;
                transition: opacity 0.2s ease;
            }

            .focus-visible:focus::after {
                opacity: 1;
            }

            .loading {
                position: relative;
                opacity: 0.7;
            }

            .loading::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 24px;
                height: 24px;
                margin: -12px;
                border: 2px solid var(--blue);
                border-top-color: transparent;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            
            .home-icon {
                cursor: pointer;
                /* Ajuste o tamanho conforme necessário */
                width: 32px;
                height: 32px;
            }

            .home-icon:hover {
                opacity: 0.8;
            }

            .artifact-result {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            }

            .result-content {
                background: white;
                padding: 2rem;
                border-radius: 10px;
                text-align: center;
                max-width: 500px;
            }

            .result-button {
                background-color: #4682B4;
                color: white;
                padding: 10px 20px;
                border: none;
                margin: 10px;
                cursor: pointer;
                transition: opacity 0.3s;
            }

            .result-button:hover {
                opacity: 0.8;
            }

            .module-header {
                display: flex;
                align-items: center;
                padding: 1rem;
                background-color: #f5f5f5;
                border-bottom: 1px solid #ddd;
            }

            .home-icon {
                width: 32px;
                height: 32px;
                margin-right: 1rem;
                cursor: pointer;
            }

            .title-container {
                display: flex;
                flex-direction: column;
            }

            .module-title {
                font-family: 'Quicksand', sans-serif;
                color: var(--blue);
                margin: 0;
                font-size: 1.5rem;
            }

            .artifact-title {
                font-family: 'Open Sans', sans-serif;
                color: #666;
                margin: 0.25rem 0 0 0;
                font-size: 1rem;
            }

        </style>
    </head>
    <body>
        <div class="container">
            <!-- Menu Lateral -->
            <nav class="sidebar">
                <div class="logo-container">
                    <div class="logo" aria-label="Logo World Teaching School" onclick="moduleManager.returnToMain()"></div>
                </div>
                
                <div class="user-progress">
                    <div class="progress-item">
                        <h3 style="color: var(--yellow); margin-bottom: 1rem;">Seu Progresso</h3>
                        <div class="module-progress">
                            <div class="module-progress-bar" style="width: 30%"></div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Conteúdo Principal -->
            <main class="module-grid">
                <!-- Módulo Exemplo -->
                <div class="module-card" data-module="1">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Greeting</h2>
                    <p>Cumprimentar, saudar ou iniciar uma conversa com outras pessoas</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;"                                  
                        aria-label="Ilustração interativa do módulo 1">               
                    </div>
                </div>

                <div class="module-card" data-module="2">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Palavras Mágicas I</h2>
                    <p>Cores, Números, Roupas, Comidas, Acessórios, Animais</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;"                      
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="3">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Palavras Mágicas II</h2>
                    <p> Mêses, Anos, Estações</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="4">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Artigos definidos e indefinidos e pronomes objetivos</h2>
                    <p>Uso de artigos (a, an, the) e pronomes objetivos (me, him, her, etc.)</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="5">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Adjetivos e verbos mais usados</h2>
                    <p>Adjetivos e verbos mais comuns</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="6">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Verbo "To be"</h2>
                    <p> verbo "to be" (ser/estar), suas conjugações e usos em frases afirmativas, negativas e interrogativas</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="7">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Simple Present</h2>
                    <p>Tempo verbal essencial, usado para falar sobre rotinas, fatos gerais e preferências pessoais</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="8">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">WH Questions (com Auxiliar e Verbo "To be")</h2>
                    <p>Como formar perguntas usando palavras interrogativas (who, what, where, when, why, how) com o verbo "to be" e outros auxiliares</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="9">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Preposições</h2>
                    <p>Palavras curtas (como in, on, at) usadas para indicar relações de tempo, lugar e direção</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <div class="module-card" data-module="10">
                    <div class="badge">⭐</div>
                    <h2 style="font-family: 'Quicksand', sans-serif; color: var(--blue);">Resumo</h2>
                    <p>Revisão geral dos tópicos estudados, consolidando o aprendizado e preparando o aluno para situações reais</p>
                    <div class="module-progress">
                        <div class="global-progress-bar module-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="module-illustration" 
                        style="height: 150px; background: #eee; border-radius: 10px; margin: 1rem 0;" 
                        aria-label="Ilustração do módulo">
                    </div>
                </div>

                <!-- Adicione mais módulos aqui -->
            </main>

            <!-- Telas de Módulo -->            
            <section class="exercise-screen" id="moduleContentContainer">
                <div class="module-header">
                    <img src="home-icon.png" alt="Voltar para o início" class="home-icon" onclick="moduleManager.returnToMain()">
                    <div class="title-container">
                        <h1 id="currentModuleTitle" class="module-title"></h1>
                        <h2 id="currentArtifactTitle" class="artifact-title"></h2>
                    </div>
                </div>
                <div id="contentFrame" style="width: 100%; height: calc(100vh - 100px);"></div>
            </section>

            <!-- Contêiner de Resultado -->
            <div class="result-container" id="resultContainer">
                <div class="result-content" id="resultContent">
                    <h3 id="resultMessage"></h3>
                    <div class="badge" id="earnedBadge"></div>
                    <button onclick="closeResultAndReturn()">Voltar ao Menu</button>
                </div>
            </div>

            <section class="results-screen" id="resultsScreen">
                <div class="results-container">
                    <div class="celebration">🎉</div>
                    <h2 style="color: var(--green);">Parabéns!</h2>
                    <p id="resultMessage">Você completou o módulo com sucesso!</p>
                    <div class="progress-update">
                        <div class="progress-circle" id="scoreCircle">0%</div>
                        <div class="progress-circle" id="timeCircle">0s</div>
                    </div>
                    <div id="newBadge" class="badge"></div>
                    <button class="main-button" onclick="showScreen('module-grid')">Continuar Aprendendo</button>
                </div>
            </section>

            <!-- Result Screen -->
            <div class="artifact-result" id="artifactResult" style="display: none;">
                <div class="result-content">
                    <h3 id="resultTitle"></h3>
                    <p id="resultScore"></p>
                    <div class="result-actions">
                        <button id="retryButton" class="result-button">Tentar Novamente</button>
                        <button id="nextButton" class="result-button">Próximo</button>
                    </div>
                </div>
            </div>

        </div>

        <script>        
            // ModuleContent.js - Define o conteúdo específico de cada módulo
            class ModuleContent {
                static getModuleDefinitions() {
                    return {
                        1: {
                            title: "Greeting",
                            description: "Cumprimentar, saudar ou iniciar uma conversa",
                            sequence: [
                                {
                                    type: 'exercise',
                                    url: 'greeting/greet_ex1.html',
                                    title: 'Cumprimentar, saudar ou iniciar uma conversa com outras pessoas',
                                    minScore: 0
                                },
                                
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        2: {
                            title: "Palavras Mágicas I",
                            description: "Cores, Números, Roupas...",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: './palavras_I/P_MagI.html',
                                    title: 'Cores, Números, Roupas, Comidas, Acessórios, Animais',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: './palavras_I/P_MagI_Ex1.html',
                                    title: 'Practice Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: './palavras_I/P_MagI_Ex2.html',
                                    title: 'Practice Greetings',
                                    minScore: 0
                                },
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        3: {
                            title: "Palavras Mágicas II",
                            description: "Mêses, Ano, Estações",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 70
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 60
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        4: {
                            title: "Artigos definidos e indefinidos e pronomes objetivos",
                            description: "Artigos definidos e indefinidos e pronomes objetivos",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 70
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 60
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        5: {
                            title: "Adjetivos e verbos mais usados",
                            description: "Adjetivos e verbos mais usados",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 70
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 60
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        6: {
                            title: "Verbo To be",
                            description: "Verbo To be",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 70
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 60
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        7: {
                            title: "Simple Present",
                            description: "Simple Present",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 70
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 60
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        8: {
                            title: "WH Questions",
                            description: "WH Questions - com Auxiliar e Verbo To be",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 70
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 60
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        9: {
                            title: "Preposições",
                            description: "Preposições",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 70
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 60
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        10: {
                            title: "Resumo",
                            description: "Resumo",
                            sequence: [
                                {
                                    type: 'presentation',
                                    url: 'prepo/P_MagI.html',
                                    title: 'Basic Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'exercise',
                                    url: 'tobe/exercicio2.html',
                                    title: 'Practice Greetings',
                                    minScore: 0
                                },
                                {
                                    type: 'game',
                                    url: 'tobe/vocabulary-exercise.html',
                                    title: 'Greeting Match Game',
                                    minScore: 0
                                }
                            ],
                            badges: {
                                completion: { type: 'achievement', icon: '🌟', title: 'Greeting Master' },
                                perfect: { type: 'mastery', icon: '👑', title: 'Perfect Greeter' }
                            }
                        },
                        // Definições similares para módulos 2-10
                    };
                    
                }
            }

            

            // Classe principal para gerenciar o estado do curso
            // Classe principal para gerenciar o estado do curso
            class CourseState {
                constructor() {
                    this.currentModule = 1;
                    this.modules = new Map();
                    this.initializeModules();
                }
                
                initializeModules() {
                    // Inicializa os 10 módulos do curso
                    for (let i = 1; i <= 10; i++) {
                        this.modules.set(i, {
                            id: i,
                            title: document.querySelector(`[data-module="${i}"] h2`)?.textContent || `Module ${i}`,
                            progress: 0,
                            completed: false,
                            artifacts: this.getModuleArtifacts(i)
                        });
                    }
                }

                getModuleArtifacts(moduleId) {
                    // Retorna a configuração de artefatos para cada módulo
                    return [
                        { type: 'presentation', url: `module${moduleId}/intro.html`, required: true },
                        { type: 'exercise', url: `module${moduleId}/exercise.html`, required: true },
                        { type: 'game', url: `module${moduleId}/game.html`, required: false }
                    ];
                }

                canAccessModule(moduleId) {
                    if (moduleId === 1) return true;
                    const previousModule = this.modules.get(moduleId - 1);
                    return previousModule && previousModule.completed;
                }

                updateGlobalProgress() {
                    const globalProgress = this.calculateGlobalProgress();
                    const progressBar = document.querySelector('.global-progress-bar');
                    if (progressBar) {
                        progressBar.style.width = `${globalProgress}%`;
                        progressBar.textContent = `${globalProgress}%`; // Adicione esta linha
                    }
                }

                updateModuleProgress(moduleId, progress) {
                    const module = this.modules.get(moduleId);
                    if (module) {
                        module.progress = progress;
                        if (progress >= 100) {
                            module.completed = true;
                        }
                    }
                    this.updateGlobalProgress();
                }

                setCurrentArtifact(moduleId, artifactIndex) {
                    this.currentModule = moduleId;
                    this.currentArtifactIndex = artifactIndex;
                }

                getModuleProgress(moduleId) {
                    const module = this.modules.get(moduleId);
                    return module?.progress || 0;
                }

                calculateGlobalProgress() {
                    const totalModules = this.modules.size;
                    let completed = 0;
                    
                    this.modules.forEach(module => {
                        if (module.progress >= 100) completed++;
                    });
                    
                    return Math.round((completed / totalModules) * 100);
                }

                getProgressData() {
                    return {
                        currentModule: this.currentModule,
                        modules: Array.from(this.modules.entries())
                    };
                }
            }

            // Gerenciador de artefatos
            class ArtifactManager {
                constructor(courseState, storage, gamification, onModuleComplete, eventBus) {
                    this.courseState = courseState;
                    this.storage = storage;
                    this.gamification = gamification;
                    this.onModuleComplete = onModuleComplete;
                    this.eventBus = eventBus;
                    this.contentFrame = document.getElementById('contentFrame');
                    this.currentModule = null;
                    this.currentArtifactIndex = 0;
                    this.isLoading = false;
                    this.messageQueue = new Map();
                    this.setupMessageListener();
                }

                setupMessageListener() {
                    window.addEventListener('message', async (event) => {
                        if (event.origin !== window.location.origin) return;

                        // Gerar um ID único para esta mensagem
                        const messageId = Date.now().toString();
                        
                        try {
                            const { type, data } = event.data;
                            
                            // Criar uma Promise para esta mensagem
                            const messagePromise = new Promise((resolve, reject) => {
                                this.messageQueue.set(messageId, { resolve, reject });
                                
                                // Timeout para limpar a Promise se não houver resposta
                                setTimeout(() => {
                                    if (this.messageQueue.has(messageId)) {
                                        this.messageQueue.delete(messageId);
                                        reject(new Error('Message timeout'));
                                    }
                                }, 5000); // 5 segundos de timeout
                            });
                            console.log("type: ");
                            console.log(type);
                            switch(type) {
                                case 'artifactComplete':
                                    await this.handleArtifactCompletion(data);
                                    break;
                                case 'returnToMenu':
                                    this.returnToMainMenu();
                                    break;
                                case 'error':
                                    console.error('Erro no artefato:', data.error);
                                    break;
                            }

                            // Resolver a Promise após o processamento
                            if (this.messageQueue.has(messageId)) {
                                this.messageQueue.get(messageId).resolve();
                                this.messageQueue.delete(messageId);
                            }

                            await messagePromise;

                        } catch (error) {
                            console.error('Erro ao processar mensagem:', error);
                            if (this.messageQueue.has(messageId)) {
                                this.messageQueue.get(messageId).reject(error);
                                this.messageQueue.delete(messageId);
                            }
                        }
                    });
                }

                // Método para enviar mensagem com garantia de resposta
                async sendMessageToFrame(message) {
                    const messageId = Date.now().toString();
                    
                    try {
                        const iframe = this.contentFrame.querySelector('iframe');
                        if (!iframe) throw new Error('iframe não encontrado');

                        const messagePromise = new Promise((resolve, reject) => {
                            this.messageQueue.set(messageId, { resolve, reject });
                            
                            setTimeout(() => {
                                if (this.messageQueue.has(messageId)) {
                                    this.messageQueue.delete(messageId);
                                    reject(new Error('Message timeout'));
                                }
                            }, 5000);
                        });

                        iframe.contentWindow.postMessage({ ...message, messageId }, window.location.origin);
                        await messagePromise;

                    } catch (error) {
                        console.error('Erro ao enviar mensagem:', error);
                        throw error;
                    } finally {
                        this.messageQueue.delete(messageId);
                    }
                }

                showModuleScreen() {
                    const moduleContentContainer = document.getElementById('moduleContentContainer');
                    if (moduleContentContainer) {
                        moduleContentContainer.style.display = 'block';
                    }

                    const moduleGrid = document.querySelector('.module-grid');
                    if (moduleGrid) {
                        moduleGrid.style.display = 'none';
                    }
                }

                async loadModule(moduleId) {
                    if (this.isLoading) {
                        console.log('Already loading');
                        return false;
                    }

                    try {
                        this.isLoading = true;
                        this.currentModule = moduleId;
                        this.currentArtifactIndex = 0;
                        
                        const success = await this.loadArtifact(moduleId, 0);
                        if (success) {
                            this.showModuleScreen();
                            return true;
                        }
                        return false;
                    } catch (error) {
                        console.error('Failed to load module:', error);
                        return false;
                    } finally {
                        this.isLoading = false;
                    }
                }

                handleArtifactLoadError(error) {
                    console.error("Error loading artifact:", error);
                    ToastSystem.show("Error loading content. Please try again.", "error");
                }

                async loadArtifact(moduleId, artifactIndex) {
                    const moduleDef = ModuleContent.getModuleDefinitions()[moduleId];
                    if (!moduleDef || !moduleDef.sequence[artifactIndex]) {
                        console.error('Module definition or artifact not found');
                        return false;
                    }

                    const artifact = moduleDef.sequence[artifactIndex];
                    
                    try {
                        // Atualizar títulos
                        const moduleTitleElement = document.getElementById('currentModuleTitle');
                        const artifactTitleElement = document.getElementById('currentArtifactTitle');
                        
                        if (moduleTitleElement && artifactTitleElement) {
                            moduleTitleElement.textContent = moduleDef.title;
                            artifactTitleElement.textContent = artifact.title;
                        }

                        // Clear existing content
                        this.contentFrame.innerHTML = '';
                        
                        // Create and configure iframe
                        const iframe = document.createElement('iframe');
                        iframe.style.width = '100%';
                        iframe.style.height = '100%';
                        iframe.style.border = 'none';
                        iframe.src = artifact.url;
                        
                        // Add loading indicator
                        iframe.addEventListener('load', () => {
                            iframe.classList.remove('loading');
                        });
                        
                        // Add error handling
                        iframe.addEventListener('error', (error) => {
                            this.handleArtifactLoadError(error);
                        });

                        // Append iframe to content frame
                        this.contentFrame.appendChild(iframe);
                        
                        this.courseState.setCurrentArtifact(moduleId, artifactIndex);
                        
                        return true;
                    } catch (error) {
                        console.error("Error loading artifact:", error);
                        this.handleArtifactLoadError(error);
                        return false;
                    }
                }

                async handleArtifactCompletion(data) {
                    try {
                        const moduleDef = ModuleContent.getModuleDefinitions()[this.currentModule];
                        const currentArtifact = moduleDef.sequence[this.currentArtifactIndex];
                        
                        // Mostrar tela de resultado
                        this.showResultScreen(data.score, currentArtifact.minScore);

                        // Atualizar progresso mesmo se não passar
                        this.courseState.updateModuleProgress(
                            this.currentModule,
                            ((this.currentArtifactIndex + 1) / moduleDef.sequence.length) * 100
                        );

                        this.gamification.checkProgress(this.currentModule, data.score);
                        this.storage.saveProgress(this.courseState.getProgressData());

                        this.gamification.checkProgress(this.currentModule, data.score);

                    } catch (error) {
                        console.error('Error processing artifact completion:', error);
                        ToastSystem.show('Error saving progress', 'error');
                    }
                }

                showModuleCompletion() {
                    const resultsScreen = document.getElementById('resultsScreen');
                    const resultMessage = document.getElementById('resultMessage');

                    resultMessage.textContent = `Você completou o módulo ${this.currentModule} com sucesso!`;
                    resultsScreen.style.display = 'block';
                    document.querySelector('.module-grid').style.display = 'none'; // Hide module grid

                    // Reset the display after a delay (or based on user action)
                    setTimeout(() => {
                        resultsScreen.style.display = 'none';
                        document.querySelector('.module-grid').style.display = 'grid';  // Show module grid again
                        this.courseState.updateModuleProgress(this.currentModule, 100);
                        this.updateModuleCards(); // Ensure cards are updated after completion
                    }, 5000); // Example 5-second display
                }

                updateModuleCards() {
                    document.querySelectorAll('.module-card').forEach(card => {
                        const moduleId = parseInt(card.dataset.module);
                        const moduleState = this.courseState.modules.get(moduleId);
                        if (moduleState) {
                            const progressBar = card.querySelector('.module-progress-bar');
                            progressBar.style.width = `${moduleState.progress}%`;

                            if (moduleState.completed) {
                                card.classList.add('completed');
                            }
                        }
                    });
                }

                showResultScreen(score, minScore) {
                    const resultScreen = document.getElementById('artifactResult');
                    const resultTitle = document.getElementById('resultTitle');
                    const resultScore = document.getElementById('resultScore');
                    const retryButton = document.getElementById('retryButton');
                    const nextButton = document.getElementById('nextButton');

                    resultTitle.textContent = score >= minScore ? 'Parabéns!' : 'Tente Novamente';
                    resultScore.textContent = `Pontuação: ${score}% (Mínimo requerido: ${minScore}%)`;
                    
                    resultScreen.style.display = 'flex';
                    
                    nextButton.style.display = score >= minScore ? 'inline-block' : 'none';
                    retryButton.style.display = 'inline-block';

                    // Configurar listeners
                    retryButton.onclick = () => {
                        resultScreen.style.display = 'none';
                        this.reloadCurrentArtifact();
                    };

                    nextButton.onclick = () => {
                        resultScreen.style.display = 'none';
                        this.loadNextArtifactOrComplete();
                    };
                }

                async reloadCurrentArtifact() {
                    await this.loadArtifact(this.currentModule, this.currentArtifactIndex);
                }

                async loadNextArtifactOrComplete() {
                    if (this.hasNextArtifact()) {
                        this.currentArtifactIndex++;
                        await this.loadArtifact(this.currentModule, this.currentArtifactIndex);
                    } else {
                        this.completeModule();
                        this.returnToMainMenu();
                    }
                }

                returnToMainMenu() {
                    document.getElementById('moduleContentContainer').style.display = 'none';
                    document.querySelector('.module-grid').style.display = 'grid';
                    this.cleanup();
                }

                hasNextArtifact() {
                    const moduleDef = ModuleContent.getModuleDefinitions()[this.currentModule];
                    return this.currentArtifactIndex < moduleDef.sequence.length - 1;
                }

                async loadNextArtifact() {
                    this.currentArtifactIndex++;
                    const success = await this.loadArtifact(this.currentModule, this.currentArtifactIndex);
                    if (!success) {
                        ToastSystem.show('Error loading next content', 'error');
                    }
                }
                
                completeModule() {
                    this.showModuleCompletion(); // Call the new function
                    this.eventBus.emit('moduleComplete', this.currentModule); // Emit module completion event                    
                }

                cleanup() {
                    this.contentFrame.innerHTML = '';
                    this.currentModule = null;
                    this.currentArtifactIndex = 0;
                    this.isLoading = false;
                }
            }

            // Sistema de Gamificação
            class GamificationSystem {
                constructor(storage) { // Recebe storage como parâmetro
                    this.storage = storage;
                    this.badges = new Map();
                    this.initializeBadges();
                }

                initializeBadges() {
                    // Implementação básica de badges
                    this.badges.set('first_completion', {
                        id: 'first_completion',
                        title: 'First Steps',
                        icon: '🌟'
                    });
                }

                displayBadge(badge) {
                    // Encontre o card do módulo atual
                    const moduleCard = document.querySelector(`.module-card[data-module="${moduleManager.courseState.currentModule}"]`);

                    if (moduleCard) {
                        // Crie um elemento para o badge
                        const badgeElement = document.createElement('div');
                        badgeElement.classList.add('badge', 'achievement-badge'); // Adicione a classe 'achievement-badge'
                        badgeElement.textContent = badge.icon;
                        badgeElement.dataset.tooltip = badge.title; // Adiciona tooltip
                        moduleCard.appendChild(badgeElement);

                        // Animação opcional (requer CSS para .achievement-badge) - veja o CSS atualizado abaixo
                    }
                }

                checkProgress(moduleId, score) {
                    if (score >= 90) this.grantBadge(moduleId, 'perfect');
                    else if (score >= 70) this.grantBadge(moduleId, 'completion');
                }
                
                grantBadge(moduleId, type) {
                    const badge = ModuleContent.getModuleDefinitions()[moduleId].badges[type];
                    if (badge) {
                        this.storage.saveBadge(moduleId, badge.type); // Passa parâmetros corretos
                        this.displayBadge(badge); // Exiba na UI
                    }
                }
            }

            // storage.js
            class StorageService {
                constructor() {
                    this.PROGRESS_KEY = 'moduleProgress';
                    this.BADGES_KEY = 'userBadges';
                }

                getProgress() {
                    return JSON.parse(localStorage.getItem(this.PROGRESS_KEY)) || {
                        globalProgress: 0,
                        modules: {},
                        currentExercise: null
                    };
                }

                saveProgress(progress) {
                    localStorage.setItem(this.PROGRESS_KEY, JSON.stringify(progress));
                }

                getBadges() {
                    return JSON.parse(localStorage.getItem(this.BADGES_KEY)) || {};
                }
                
                saveBadge(moduleId, badgeType) {
                    const badges = this.getBadges();
                    badges[moduleId] = badgeType;
                    localStorage.setItem(this.BADGES_KEY, JSON.stringify(badges));
                }
            }

            // moduleManager.js
            class ModuleManager {
                constructor(storage, eventBus) {
                this.storage = storage;
                this.courseState = new CourseState();
                this.gamification = new GamificationSystem(this.storage);
                this.eventBus = eventBus; // Armazena a referência do eventBus
                this.eventBus.on('progressUpdate', () => {
                this.courseState.updateGlobalProgress();
                });

                this.artifactManager = new ArtifactManager(
                    this.courseState,
                    this.storage,
                    this.gamification,
                    this.handleModuleCompletion.bind(this),
                    this.eventBus // Passa o eventBus para o ArtifactManager
                );

                this.initializeUI();

                // Inscreve-se no evento de conclusão de módulo
                this.eventBus.on('moduleComplete', (moduleId) => {
                    console.log(`Módulo ${moduleId} completado`);
                    this.updateModuleCards(); // Atualiza a interface do usuário
                    this.storage.saveProgress(this.courseState.getProgressData());
                });
            }
                
                // Manipulador de eventos para completude do módulo
                handleModuleCompletion(moduleId) {
                    console.log(`Módulo ${moduleId} completado`);
                    this.updateModuleCards();
                    this.storage.saveProgress(this.courseState.getProgressData());
                }

                initializeUI() {
                    this.setupEventListeners();
                    this.updateModuleCards();
                }

                setupEventListeners() {
                    document.querySelectorAll('.module-card').forEach(card => {
                        card.addEventListener('click', () => {
                            const moduleId = parseInt(card.dataset.module);
                            this.loadModule(moduleId);
                        });
                    });
                }

                updateModuleCards() {
                    document.querySelectorAll('.module-card').forEach(card => {
                        const moduleId = parseInt(card.dataset.module);
                        const module = this.courseState.modules.get(moduleId);
                        if (module) {
                            this.updateModuleCard(card, module);
                        }
                    });
                }

                updateModuleCard(card, module) {
                    const progressBar = card.querySelector('.module-progress-bar');
                    if (progressBar) {
                        progressBar.style.width = `${module.progress}%`;
                    }
                    
                    if (!this.courseState.canAccessModule(module.id)) {
                        card.classList.add('locked');
                    } else {
                        card.classList.remove('locked');
                    }
                }

                async loadModule(moduleId) {
                    try {
                        console.log(`Iniciando carregamento do módulo ${moduleId}`);
                        if (!this.courseState.canAccessModule(moduleId)) {
                            console.log(`Módulo ${moduleId} bloqueado`);
                            ToastSystem.show("Complete o módulo anterior primeiro!", "warning");
                            return;
                        }

                        document.querySelector(".module-grid").style.display = "none";
                        document.getElementById("moduleContentContainer").style.display = "block";

                        const loaded = await this.artifactManager.loadModule(moduleId);
                        if (!loaded) {
                            throw new Error("Falha ao carregar módulo");
                        }

                        console.log(`Módulo ${moduleId} carregado com sucesso`);
                    } catch (error) {
                        console.error("Erro ao carregar módulo:", error);
                        this.handleModuleLoadError(moduleId, error);
                    }
                }


                handleModuleLoadError(moduleId, error) {
                    console.error(`Erro ao carregar módulo ${moduleId}:`, error);
                    ToastSystem.show('Erro ao carregar o módulo. Tente novamente.', 'error');
                    this.returnToMain();
                }
                
                returnToMain() {
                    document.getElementById('moduleContentContainer').style.display = 'none';
                    document.querySelector('.module-grid').style.display = 'grid';
                }
                
            }
            // uiController.js
            // Sistema de UI
            class UIController {
                constructor(courseState, artifactManager, gamification) {
                    this.courseState = courseState;
                    this.artifactManager = artifactManager;
                    this.gamification = gamification;
                    this.initializeUI();
                }

                initializeUI() {
                    this.updateModuleCards();
                    this.setupEventListeners();
                    this.updateProgressBars();
                }

                updateModuleCards() {
                    document.querySelectorAll('.module-card').forEach(card => {
                        const moduleId = parseInt(card.dataset.module);
                        const module = this.courseState.modules.get(moduleId);
                        if (module) {
                            this.updateModuleCard(card, module);
                        }
                    });
                }

                updateModuleCard(card, module) {
                    const progress = module.calculateProgress();
                    const progressBar = card.querySelector('.module-progress-bar');
                    progressBar.style.width = `${progress}%`;
                    
                    if (!this.courseState.canAccessModule(module.id)) {
                        card.classList.add('locked');
                    }
                }

                setupEventListeners() {
                    document.querySelectorAll('.module-card').forEach(card => {
                        card.addEventListener('click', async () => {
                            const moduleId = parseInt(card.dataset.module);
                            if (this.courseState.canAccessModule(moduleId)) {
                                await this.artifactManager.loadArtifact(moduleId, 0);
                                this.showModuleContent();
                            } else {
                                this.showLockedModuleMessage();
                            }
                        });
                    });
                }

                
            }

            class ToastSystem {
                static show(message, type = 'info') {
                    const toast = document.createElement('div');
                    toast.className = `toast toast-${type}`;
                    toast.innerHTML = `
                        <div class="toast-content">
                            <i class="toast-icon"></i>
                            <span>${message}</span>
                        </div>
                        <div class="toast-progress"></div>
                    `;
                    
                    document.body.appendChild(toast);
                    
                    setTimeout(() => {
                        toast.classList.add('show');
                        setTimeout(() => {
                            toast.classList.remove('show');
                            setTimeout(() => toast.remove(), 300);
                        }, 3000);
                    }, 100);
                }
            }

            class ExerciseFeedback {
                static showResult(correct, element) {
                    const feedback = document.createElement('div');
                    feedback.className = `answer-feedback ${correct ? 'correct' : 'incorrect'}`;
                    
                    feedback.innerHTML = correct ? 
                        '<i class="check-icon"></i> Correto!' :
                        '<i class="x-icon"></i> Tente novamente';
                        
                    element.appendChild(feedback);
                    
                    setTimeout(() => feedback.remove(), 2000);
                }
            }
            class EventBus {
                constructor() {
                    this.listeners = new Map();
                }

                on(event, callback) {
                    if (!this.listeners.has(event)) {
                        this.listeners.set(event, new Set());
                    }
                    this.listeners.get(event).add(callback);
                }

                off(event, callback) {
                    if (this.listeners.has(event)) {
                        this.listeners.get(event).delete(callback);
                    }
                }

                emit(event, data) {
                    if (this.listeners.has(event)) {
                        this.listeners.get(event).forEach(callback => {
                            try {
                                callback(data);
                            } catch (error) {
                                console.error(`Erro ao executar callback para evento ${event}:`, error);
                            }
                        });
                    }
                }

                cleanup() {
                    this.listeners.clear();
                }
            }

            // main.js

            document.addEventListener('DOMContentLoaded', () => {
                const storage = new StorageService();
                const eventBus = new EventBus(); // Certifique-se de que esta linha está presente
                window.moduleManager = new ModuleManager(storage, eventBus);

                setTimeout(() => {
                    if (window.moduleManager.courseState) {
                        window.moduleManager.courseState.updateGlobalProgress();
                    }
                }, 100);
            });
            // Atualiza barras de progresso ao carregar

            if (window.moduleManager && window.moduleManager.courseState) {
                window.moduleManager.courseState.updateGlobalProgress();
            }

        </script>
    </body>
    </html>
